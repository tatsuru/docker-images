FROM perl:latest

MAINTAINER wtatsuru

RUN apt-get update && apt-get install default-libmysqlclient-dev
RUN git clone https://github.com/jasherai/maatkit /app && cpanm DBI && cpanm DBD::mysql
RUN mkdir -p /usr/local/bin \
    && chmod +x /app/mk-archiver/mk-archiver /app/mk-config-diff/mk-config-diff /app/mk-deadlock-logger/mk-deadlock-logger /app/mk-duplicate-key-checker/mk-duplicate-key-checker /app/mk-error-log/mk-error-log /app/mk-fifo-split/mk-fifo-split /app/mk-find/mk-find /app/mk-fk-error-logger/mk-fk-error-logger /app/mk-heartbeat/mk-heartbeat /app/mk-index-usage/mk-index-usage /app/mk-kill/mk-kill /app/mk-loadavg/mk-loadavg /app/mk-log-player/mk-log-player /app/mk-log-server/mk-log-server /app/mk-online-schema-change/mk-online-schema-change /app/mk-parallel-dump/mk-parallel-dump /app/mk-parallel-restore/mk-parallel-restore /app/mk-purge-logs/mk-purge-logs /app/mk-query-advisor/mk-query-advisor /app/mk-query-digest/mk-query-digest /app/mk-query-profiler/mk-query-profiler /app/mk-schema-advisor/mk-schema-advisor /app/mk-show-grants/mk-show-grants /app/mk-slave-delay/mk-slave-delay /app/mk-slave-find/mk-slave-find /app/mk-slave-move/mk-slave-move /app/mk-slave-prefetch/mk-slave-prefetch /app/mk-slave-restart/mk-slave-restart /app/mk-table-access/mk-table-access /app/mk-table-checksum/mk-table-checksum /app/mk-table-scan/mk-table-scan /app/mk-table-sync/mk-table-sync /app/mk-trend/mk-trend /app/mk-upgrade/mk-upgrade /app/mk-variable-advisor/mk-variable-advisor /app/mk-visual-explain/mk-visual-explain \
    && ln -s /app/mk-archiver/mk-archiver /app/mk-config-diff/mk-config-diff /app/mk-deadlock-logger/mk-deadlock-logger /app/mk-duplicate-key-checker/mk-duplicate-key-checker /app/mk-error-log/mk-error-log /app/mk-fifo-split/mk-fifo-split /app/mk-find/mk-find /app/mk-fk-error-logger/mk-fk-error-logger /app/mk-heartbeat/mk-heartbeat /app/mk-index-usage/mk-index-usage /app/mk-kill/mk-kill /app/mk-loadavg/mk-loadavg /app/mk-log-player/mk-log-player /app/mk-log-server/mk-log-server /app/mk-online-schema-change/mk-online-schema-change /app/mk-parallel-dump/mk-parallel-dump /app/mk-parallel-restore/mk-parallel-restore /app/mk-purge-logs/mk-purge-logs /app/mk-query-advisor/mk-query-advisor /app/mk-query-digest/mk-query-digest /app/mk-query-profiler/mk-query-profiler /app/mk-schema-advisor/mk-schema-advisor /app/mk-show-grants/mk-show-grants /app/mk-slave-delay/mk-slave-delay /app/mk-slave-find/mk-slave-find /app/mk-slave-move/mk-slave-move /app/mk-slave-prefetch/mk-slave-prefetch /app/mk-slave-restart/mk-slave-restart /app/mk-table-access/mk-table-access /app/mk-table-checksum/mk-table-checksum /app/mk-table-scan/mk-table-scan /app/mk-table-sync/mk-table-sync /app/mk-trend/mk-trend /app/mk-upgrade/mk-upgrade /app/mk-variable-advisor/mk-variable-advisor /app/mk-visual-explain/mk-visual-explain  /usr/local/bin

ENV PATH /usr/local/bin:/usr/bin:/bin
CMD ["mk-config-diff"]
